```
title:"高并发和大流量解决方案之减少HTTP请求次数"
```
## 减少HTTP请求次数
### 为什么要减少HTTP请求
性能黄金法则

- 只有10% - 20%的最终用户响应时间花在接受请求的HTML文档上
- 剩下的80%-90%时间花在HTML文档所引用的所有组件（图片、script、css、flash等等）进行的HTTP请求上。
- 如何改善

改善响应时间的最简单途径就是减少组件的数量，并由此减少HTTP请求的数量

### HTTP连接产生的开销
- 域名解析--TCP连接--发送请求--等待--下载资源--解析时间
- 疑问？
	- 本身dns解析是有DNS缓存的 ，所以我们不用担心，他已经把解析过的缓存了
	- 本身http1.1版本默认是通过Keep-Alive方式进行操作的，不会去花费tcp握手的时间了
	- 但是，需要注意：http本身是串行请求的，还是会浪费一定的时间
#### 打破谣言
1. 查找DNS缓存也需要时间，多个缓存就要查找多次，缓存有可能会被清除
2. HTTP1.1协议规定请求只能串行发送，也就是说一百个请求必须依次逐个发送，前面的一个请求完成才能开始下一个请求，会造成一定的响应时间的影响
3. 所以我们还是应该尽量的减少我们的http请求

### 减少HTTP请求的方式
1. 图片地图
	- 图片地图允许你在一个图片上关联多个url，目标url的选择取决于用户单击了图片上的哪个位置。
	- 可以通过使用五个分开的图片，然后每个图片对应一个超链接
	- 如果使用5张图片来分别代表一个超链接时，此时就会产生5个http请求，我们的目标是要减少HTTP请求
	- 将5个图片合并为一张图片，然后以位置信息定位超链接（精灵图） 
	- 把HTTP请求减少为一个，可以保证设计的完整性和功能的齐全性
2. 实现方式	
#### 使用<map><area></area></map>标签
	demo:
		- [未使用图片地图的方式](http://stevesouders.com/hpws/imagemap-no.php),页面整体加载时间1.16s，每一个图片都会产生一个HTTP链接
		-[通过图片地图的方式](http://stevesoud ers.com/hpws/imagemap.php)，此时请求时间400ms，只有一个http请求,页面加载速度快了很多
```
<img usermap="#map1" border="0" src="img.jpg">
<map name="map1">
	<area shape="rect" coords="0,0,31,31" href="..php"></area>
</map>

```
#### CSS Sprites css精灵
通过使用background-image background-position来显示元素

#### 性能影响
图片地图与CSS精灵的响应时间基本上相同，但比使用各自独立图片的方式要快50%以上（通常图片精灵使用的较多一点）

#### 合并脚本和样式表（因为一个js文件就需要请求一次）
1. 使用外部js和css文件引用的方式，这要比直接写在页面中性能要更好一点
2. 独立的一个js比用多个js文件组成的页面载入要快38%
3. 把多个脚本合并为一个脚本，把多个样式表合并为一个样式表
- demo
	- [未合并](http://stevesouders.com/hpws/combo-none.php)
	- [合并](http://stevesouders.com/hpws/combo.php)
	- 页面加载速度变快了
#### 图片使用base64编码减少页面请求数
- 由于一个页面可能会加载很多图片，可能有的图片能够合并，有的图片合并在一起不太合适
- 采用Base64的编码方式将图片直接嵌入到网页中，而不是从外部载入 
- 相应的加载html文档的时间增长一点，但是减少了http的请求次数

```
file_get_contents（）,base64()
```	




